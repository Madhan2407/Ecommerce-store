{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/custom.css' %}">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <meta name="description" content="{% block metadescription %}{% endblock %}">
    <title>{% block title %}Macyx Fashion - Modern Ecommerce{% endblock %}</title>
</head>
<body>
    <!-- Header -->
    {% include 'header.html' %}
    
    <!-- Navigation -->
    {% include 'navbar.html' %}
    
    <!-- Main Content -->
    <main class="main-content">
        {% block content %}
        {% endblock %}
    </main>
    
    <!-- Footer -->
    {% include 'footer.html' %}
    
    <!-- Bootstrap JS -->
    <script src="{% static 'js/popper.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>
    
    <!-- Custom JS -->
    <script>
        // Add smooth scrolling
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({
                    behavior: 'smooth'
                });
            });
        });
        
        // Add fade-in animation to elements
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };
        
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('fade-in');
                }
            });
        }, observerOptions);
        
        // Observe all product cards and other elements
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.product-card, .product-detail, .category-banner').forEach(el => {
                observer.observe(el);
            });
            
            // Enhanced 3D Flip Card Functionality
            initializeFlipCards();
        });
        
        // 3D Flip Card Initialization
        function initializeFlipCards() {
            const flipCards = document.querySelectorAll('.flip-card');
            
            flipCards.forEach((card, index) => {
                // Add staggered animation delay
                card.style.setProperty('--card-index', index);
                
                // Add click functionality for mobile devices
                card.addEventListener('click', function(e) {
                    if (window.innerWidth <= 768) {
                        const inner = this.querySelector('.flip-card-inner');
                        const isFlipped = inner.style.transform.includes('rotateY(180deg)');
                        
                        if (isFlipped) {
                            inner.style.transform = 'rotateY(0deg)';
                        } else {
                            inner.style.transform = 'rotateY(180deg)';
                        }
                    }
                });
                
                // Add keyboard navigation support
                card.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        const inner = this.querySelector('.flip-card-inner');
                        const isFlipped = inner.style.transform.includes('rotateY(180deg)');
                        
                        if (isFlipped) {
                            inner.style.transform = 'rotateY(0deg)';
                        } else {
                            inner.style.transform = 'rotateY(180deg)';
                        }
                    }
                });
                
                // Add focus management
                card.setAttribute('tabindex', '0');
                card.setAttribute('role', 'button');
                card.setAttribute('aria-label', 'Product card - click or press Enter to flip');
            });
            
            // Add smooth flip sound effect (optional)
            flipCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    if (window.innerWidth > 768) {
                        playFlipSound();
                    }
                });
            });
        }
        
        // Optional: Add flip sound effect
        function playFlipSound() {
            // Create a subtle audio context for flip sound
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                // Audio context not supported, continue silently
            }
        }
        
        // Add parallax effect to flip cards
        function addParallaxEffect() {
            const flipCards = document.querySelectorAll('.flip-card');
            
            window.addEventListener('scroll', () => {
                const scrolled = window.pageYOffset;
                const rate = scrolled * -0.5;
                
                flipCards.forEach((card, index) => {
                    const speed = 0.1 + (index * 0.02);
                    card.style.transform = `translateY(${rate * speed}px) perspective(1000px)`;
                });
            });
        }
        
        // Initialize parallax effect
        if (window.innerWidth > 768) {
            addParallaxEffect();
        }
        
        // Add card hover effects
        function addCardHoverEffects() {
            const flipCards = document.querySelectorAll('.flip-card');
            
            flipCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.zIndex = '10';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.zIndex = '1';
                });
            });
        }
        
        // Initialize hover effects
        addCardHoverEffects();
        
        // Performance optimization: Throttle scroll events
        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }
        
        // Apply throttling to scroll events
        window.addEventListener('scroll', throttle(() => {
            // Any scroll-based animations can go here
        }, 16)); // 60fps
    </script>
</body>
</html>